# BMAC

### **What is it?**
BAMC (or BuyMeACoffee) is a platform for junior and senior developers to introduce their open source projects to other developer and community. also developers can support eachother by donating other developer (buying a coffee for them). \
develoers can share their projects in format of a Post. a post is a 512 characters text message represents as a description of the project they want to share or introduce, and link of that project (github repo or live project). other developers can like the post and also share their ideas in comment section of each post. this is a place for finding other people with different skills and abilities so by sharing and introducing your projects to the community the developers can find contributers or ideas. 

***
## **Models**
these are brief description of models in the app. fields and other explanation. 

**Note**: all models contians fields of name `createdAt` and `updatedAt` by default (mongoose does that automatically)

1. ***User***
    - **Fields**: 
        - email: String
        - username: String, between 2 and 64 characters
        - fullname: String, containing both first and last name, between 2 and 64 characters
        - password: String, at least 6 characters
        - wallet: Number, default is 0.
        - role: String, but enum

    - **description**: 
        - email validation will be done by RegEx and it's required. 

        - password will be hashed by `bcryptjs` before saving to database automaticly.

        - role is an enum. can be `user` or `admin` for now. (later, membership) 

        - for authentication purpose, token will be generated by `jsonwebtoken`. the static method `getSignedJwtToken` returns a token for user.

2. ***Post***
    - **Fields**: 
        - user: owner of the post, referenced to a User
        - title: string between 2 and 128 characters
        - description: string between 2 and 512 characters
        - projectLink: String
    - **description**: 
        - projectLink will be validated by RegEx, must contains `http` or `https` 
***
## **Working wits CLI**
### ***Importing Data***
There are some npm commands in `package.json` for seeding the database. you can use them by simply adding `yarn [command name]` or `npm run [command name]`. the list of the is like below:

- `data:import`: imports all the sample data for all of models

- `data:destroy`: cleans up the database

- `data:importUsers`: imports all users

- `data:destroyUsers`: cleans up the users collection

- `data:importPosts`: import all posts

- `data:destroyPost`: cleans up the post collection

you can find the list of sample data in the `./cli/seeder/data`.

for example for adding all the sample data to the database run this command:
```sh
$ yarn data:import
```
or if your using `npm`:
```sh
npm run data:import
```

Another way to import data is by using `cli`. the options are: 
- for importing all data
```sh
$ node cli data:import all
```
last parameter can be the name of model. for example:
```sh
$ node cli data:import user
```

in the same way, by using `data:destroy` you can clean up the data.

### ***Scaffolding***
By using cli commands, you can scaffold controller and model. for example:
```sh
$ node cli m Test
```
the argument `m` represents generating model. by running this command, a file containing base structure of a model in `./models` directory will be created.\
the argument `c` represents gererating controller with base CRUD functionality. \
the argument `e` (for entity) used for generating both model and controller at a same time.\
**Note**: routing will not be implemented by cli.
***
## **Routes List**
- Auth:
    - `/api/v1/auth/login` - accepted methods: `POST`
    - `/api/v1/auth/register` - accepted methods: `POST`
- Users:
    - `/api/v1/users` - accepted methods: `GET` | `POST`
    - `/api/v1/users/:id` - accepted methods: `GET` | `PUT` | `DELETE`
- Post:
    - `/api/v1/posts` - accepted methods: `GET` | `POST`
    - `/api/v1/posts/:id` - accepted methods: `GET` | `PUT` | `DELETE`
***
## **Controllers**
1. ### **Auth**
- ***Register***: \
The URL is `/api/v1/auth/register` and the http verb is `POST`. sample json body: /
```json
{
    "email": "sampleEamil@email.com",
    "username": "testusername",
    "fullname": "fullname test",
    "password": "password"
}
```
if the user already exists in database with that provided email, `success: false` will be return (with a message). else the user will be created and the user object (minus the password) with access token will return.
- ***Login***: \
The URL is `/api/v1/auth/login` and the http verb is `POST`. sample json body: /
```json
{
    "email": "sampleEamil@email.com",
    "password": "password"
}
```
if the authentication verified, in response, `_id`, `username`, `email` and `token` will be returnd. else `success: false` and a message will return.

2. ### **User**
- ***Get All Users*** \
simply return the array of all users. the url is `/api/v1/users` and the http method is `GET`. this route is just admin protected route.

- ***Get a single User*** \
returns a single user details by it's id. the `id` is identical to the ObjectID in mongodb. the url is `api/v1/users/:id` and the http method is `GET`. this route is available for eveyone

- ***Update a User*** \
update a user. first find it by the id in the url and replace new object with the one that is already in the database. the url is `api/v1/users/:id` and the http method is `PUT`. this route is only available for logged in user (for editing his/her own information) and also admin.

- ***Delete a User*** \
delete a user. find the user based on the id in the url and remove it from database. the response body is empty and status code is `204 No Content`. the url is `api/v1/users/:id` and the http method is `DELETE`. this route is only available for logged in user (for deleting his/her own account) and also admin.

3. ### **Post**

- ***Get all Posts*** \
simply returns all the posts in the database. the url is `/api/v1/posts` and the http method is `GET`. this route is just admin protected route.

- ***Get a single Post*** \
returns a single post details by it's id. the `id` is identical to the ObjectID in mongodb. the url is `api/v1/posts/:id` and the http method is `GET`. this route is available for eveyone

- ***Create a Post*** \
cretes a post. the url is `api/v1/posts` and the http method is `POST`. a sample json body:
```json
{
    "user": "123...",
    "title": "my awesome post",
    "description": "hey guys please check out my new awesome project...",
    "projectLink": "https://github.com/..."
}
```
the response is success flag and `201 Created` status code or `400 Bad Request`. 

- ***Update a Post*** \
update a post. first find it by the id in the url and replace new object with the one that is already in the database. the url is `api/v1/posts/:id` and the http method is `PUT`. this route is only available for logged in user (for editing his/her own post) and also admin.

- ***Delete a Post*** \
delete a post. find the post based on the id in the url and remove it from database. the response body is empty and status code is `204 No Content`. the url is `api/v1/posts/:id` and the http method is `DELETE`. this route is only available for logged in user (for deleting his/her own post) and also admin.

***
## **Middlewares**
1. **AsyncHandler**:handling promises on asynchronous functions 
2. **ErrorHanlder**: checks for some common error types (like duplicated key error) and handle them with appropriate message and status code.
3. **Authorization**: there are two functions, `protect` which is checking for toekn validation and headers, and `authorize` which grant access to different role (exactly handle authorzation).

***
version: 0.1